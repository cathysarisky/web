<script src="https://thunkable.github.io/webviewer-extension/thunkableWebviewerExtension.js" type="text/javascript"></script>

<script>  
function getBase64(file) {
   var reader = new FileReader();

   reader.readAsDataURL(file);
   ThunkableWebviewerExtension.postMessage('file is still ' + file);
   reader.onload = function () {
 
     ThunkableWebviewerExtension.postMessage(reader.result);
     console.log(reader.result);
   };
   reader.onerror = function (error) {
     
     ThunkableWebviewerExtension.postMessage('Error: ', error);
     console.log('Error: ', error);
   };
};

  const queryString = window.location.search;
  console.log(queryString);
  const urlParams = new URLSearchParams(queryString);
  const my_image = urlParams.get('image_loc') ;

ThunkableWebviewerExtension.postMessage(my_image);   
   
// var file = document.querySelector('#files > input[type="file"]').files[0];
var file = my_image

var return_this = getBase64(file); // prints the base64 string
ThunkableWebviewerExtension.postMessage(return_this);  


  
// ThunkableWebviewerExtension.postMessage(my_code);
  
  // when we get a message from the app, display it on the page
//ThunkableWebviewerExtension.receiveMessage(function(message) {
  // Do something with your message
//  const reply_message = 'base64,' + btoa(message);
//ThunkableWebviewerExtension.postMessage(reply_message);
//});
  
</script>
